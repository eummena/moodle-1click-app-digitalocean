YUI.add("moodle-gradereport_grader-gradereporttable",function(R,e){var w,h,g,l,H=".avg .header",t="#user-grades .avg .cell",i="td.grade",s=".gradeparent table",o=".gradeparent",p="#user-grades .heading .cell",r="#user-grades tr.heading",a="#studentheader",u="#user-grades .user.cell",_={OVERRIDDEN:"overridden",TOOLTIPACTIVE:"tooltipactive"};function n(){n.superclass.constructor.apply(this,arguments)}function d(){}R.extend(n,R.Base,{_eventHandles:[],graderTable:null,initializer:function(){this.graderRegion=R.one(o),this.graderTable=R.one(s),this.setupFloatingHeaders()},getGradeUserName:function(e){var t=e.ancestor("tr").one("th.user .username");return t?t.get("text"):""},getGradeItemName:function(e){var t=R.one("th.item[data-itemid='"+e.getData("itemid")+"']");return t?t.get("text"):""},getGradeFeedback:function(e){return e.getData("feedback")}}),R.namespace("M.gradereport_grader").ReportTable=n,R.namespace("M.gradereport_grader").init=function(e){return new R.M.gradereport_grader.ReportTable(e)},w="height",h="width",g="offsetWidth",l="offsetHeight",_.FLOATING="floating",d.ATTRS={},d.prototype={pageHeaderHeight:0,container:null,headerCell:null,headerRow:null,firstUserCell:null,firstNonUserCell:null,firstNonUserCellLeft:0,firstNonUserCellWidth:0,tableFooterRow:null,footerRow:null,gradeItemHeadingContainer:null,userColumnHeader:null,userColumn:null,firstUserCellBottom:0,firstUserCellLeft:0,firstUserCellWidth:0,dockWidth:0,lastUserCellTop:0,floatingHeaderRow:null,_eventHandles:[],lastBodyMargin:0,setupFloatingHeaders:function(){return this.firstUserCell=R.one(u),this.container=R.one(o),this.firstNonUserCell=R.one(i),this.firstUserCell?M.cfg.behatsiterunning?void 0:(this._setupFloatingUserColumn(),this._setupFloatingUserHeader(),this._setupFloatingAssignmentHeaders(),this._setupFloatingAssignmentFooter(),this.floatingHeaderRow={},this._setupFloatingLeftHeaders(".controls .controls"),this._setupFloatingLeftHeaders(".range .range"),this._setupFloatingLeftHeaders(H),this._setupFloatingAssignmentFooterTitle(),this._calculateCellPositions(),this._handleScrollEvent(),this._setupEventHandlers(),R.Global.on("moodle-gradereport_grader:resized",this._handleResizeEvent,this),this):this},_calculateCellPositions:function(){var e,t,i,s,o,r;this.headerRowTop=this.headerRow.getY(),this.tableFooterRow&&(this.footerRowPosition=this.tableFooterRow.getY()),this.dockWidth=0,(e=R.one(".has_dock #dock"))&&(this.dockWidth=e.get(g)),t=R.all(u),this.firstUserCellLeft=this.firstUserCell.getX(),this.firstUserCellWidth=this.firstUserCell.get(g),this.firstNonUserCellLeft=this.firstNonUserCell.getX(),this.firstNonUserCellWidth=this.firstNonUserCell.get(g),1<t.size()?(i=t.item(1),this.firstUserCellBottom=i.getY()+parseInt(i.getComputedStyle(w),10),this.lastUserCellTop=t.item(t.size()-2).getY()):(s=t.item(0),this.lastUserCellTop=s.getY(),this.tableFooterRow?this.firstUserCellBottom=this.footerRowPosition+parseInt(this.tableFooterRow.getComputedStyle(w),10):this.firstUserCellBottom=s.getY()+s.get("offsetHeight")),o=R.one("header"),this.pageHeaderHeight=0,o&&("fixed"===o.getComputedStyle("position")?this.pageHeaderHeight=o.get(l):(r=R.one(".navbar"))&&"fixed"===r.getComputedStyle("position")&&(this.pageHeaderHeight=r.get(l)))},_getRelativeXY:function(e){return this._getRelativeXYFromXY(e.getX(),e.getY())},_getRelativeXYFromXY:function(e,t){var i=this.container.getXY();return[e-i[0],t-i[1]]},_getRelativeXFromX:function(e){return this._getRelativeXYFromXY(e,0)[0]},_getRelativeYFromY:function(e){return this._getRelativeXYFromXY(0,e)[1]},_getScrollBarHeight:function(){return!(R.UA.ie&&10<=R.UA.ie)&&R.config.doc.body.scrollWidth>R.config.doc.body.clientWidth?R.DOM.getScrollbarWidth():0},_setupEventHandlers:function(){this._eventHandles.push(R.one(R.config.win).on("scroll",this._handleScrollEvent,this),R.one(R.config.win).on("resize",this._handleResizeEvent,this),R.one(R.config.win).on("orientationchange",this._handleResizeEvent,this),R.Global.on("dock:shown",this._handleResizeEvent,this),R.Global.on("dock:hidden",this._handleResizeEvent,this))},_setupFloatingUserColumn:function(){var e=R.all(u),s=R.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),t=this._getRelativeXY(this.firstUserCell);e.each(function(e){var t,i=e.getComputedStyle(w);0!==R.UA.ie&&(i=e.get("offsetHeight")-(parseInt(e.getComputedStyle("marginTop"),10)+parseInt(e.getComputedStyle("marginBottom"),10))-(parseInt(e.getComputedStyle("paddingTop"),10)+parseInt(e.getComputedStyle("paddingBottom"),10))-(parseInt(e.getComputedStyle("borderTopWidth"),10)+parseInt(e.getComputedStyle("borderBottomWidth"),10))),(t=R.Node.create("<div></div>")).set("innerHTML",e.get("innerHTML")).setAttribute("class",e.getAttribute("class")).setAttribute("data-uid",e.ancestor("tr").getData("uid")).setStyles({height:i,width:e.getComputedStyle(h)}),s.appendChild(t)},this),s.setStyles({left:t[0]+"px",position:"absolute",top:t[1]+"px"}),this.graderRegion.append(s),this.userColumn=s},_setupFloatingUserHeader:function(){this.headerRow=R.one(r),this.headerCell=R.one(a);var e=R.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly heading"></div>'),t=R.Node.create("<div></div>"),i=this._getRelativeXY(this.headerCell)[0],s=this._getRelativeXY(this.headerRow),o=s[0];t.set("innerHTML",this.headerCell.getHTML()).setAttribute("class",this.headerCell.getAttribute("class")).setStyles({width:this.firstUserCell.getComputedStyle(h),left:i-o+"px"}),e.setStyles({left:s[0]+"px",position:"absolute",top:s[1]+"px"}),e.append(t),this.graderRegion.append(e),this.userColumnHeader=e},_setupFloatingAssignmentHeaders:function(){var e,s,t,o,r,a;this.headerRow=R.one("#user-grades tr.heading"),e=R.all("#user-grades tr.heading .cell"),s=R.Node.create('<div aria-hidden="true" role="presentation" class="floater heading"></div>'),t=this._getRelativeXY(this.headerRow),a=t[r=o=0],e.each(function(e){var t=this._getRelativeXY(e)[0],i=R.Node.create("<div></div>")
;i.append(e.getHTML()).setAttribute("class",e.getAttribute("class")).setData("itemid",e.getData("itemid")).setStyles({height:e.getComputedStyle(w),left:t-a+"px",position:"absolute",width:e.getComputedStyle(h)}),o+=parseInt(e.get(g),10),r=e.get(l),s.appendChild(i)},this),s.setStyles({height:r+"px",left:t[0]+"px",position:"absolute",top:t[1]+"px",width:o+"px"}),this.userColumnHeader.insert(s,"before"),this.gradeItemHeadingContainer=s},_setupFloatingAssignmentFooter:function(){var e,s,o,t,r,a;this.tableFooterRow=R.one("#user-grades .avg"),this.tableFooterRow&&(e=this.tableFooterRow.all(".cell"),s=R.Node.create('<div aria-hidden="true" role="presentation" class="floater avg"></div>'),o=0,t=this._getRelativeXY(this.tableFooterRow),r=t[0],a=0,e.each(function(e){var t=R.Node.create("<div></div>"),i=this._getRelativeXY(e)[0];t.set("innerHTML",e.getHTML()).setAttribute("class",e.getAttribute("class")).setStyles({height:e.getComputedStyle(w),left:i-r+"px",position:"absolute",width:e.getComputedStyle(h)}),s.append(t),a=e.get(l),o+=parseInt(e.get(g),10)},this),s.setStyles({position:"absolute",left:t[0]+"px",bottom:"1px",height:a+"px",width:o+"px"}),this.graderRegion.append(s),this.footerRow=s)},_setupFloatingAssignmentFooterTitle:function(){var e=this.floatingHeaderRow[H];e&&e.setStyles({bottom:"1px"})},_setupFloatingLeftHeaders:function(e){var t,i,s,o,r,a=R.one(e);a&&(t=R.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),i=R.Node.create("<div></div>"),s=this._getRelativeXY(a),o=this.firstUserCell.getComputedStyle(h),r=a.get(l),i.set("innerHTML",a.getHTML()).setAttribute("class",a.getAttribute("class")).setStyles({width:o}),t.setStyles({position:"absolute",top:s[1]+"px",left:s[0]+"px",height:r+"px"}).addClass(a.get("parentNode").get("className")),t.append(i),this.graderRegion.append(t),this.floatingHeaderRow[e]=t)},_handleScrollEvent:function(){var e,t,i,s,o={},r={},a={},l={},n=0,d=0,h=0,g=!1,p=!1,u=!1,f=!1,c={},m={},C=!1,v=0;(v=window.right_to_left()?parseInt(R.one(R.config.doc.body).getComputedStyle("marginRight"),10):parseInt(R.one(R.config.doc.body).getComputedStyle("marginLeft"),10))!=this.lastBodyMargin&&this._calculateCellPositions(),o.left=this._getRelativeXFromX(this.headerRow.getX()),n=R.config.win.pageYOffset+this.pageHeaderHeight>this.headerRowTop?(g=!0,R.config.win.pageYOffset+this.pageHeaderHeight<this.lastUserCellTop?this._getRelativeYFromY(R.config.win.pageYOffset+this.pageHeaderHeight):this._getRelativeYFromY(this.lastUserCellTop)):(g=!1,this._getRelativeYFromY(this.headerRowTop)),o.top=n+"px",r.top=n+"px",f=window.right_to_left()?(h=(d=R.config.win.innerWidth+R.config.win.pageXOffset-this.dockWidth)-this.firstUserCellWidth-v,p=d<this.firstUserCellLeft+this.firstUserCellWidth+v,d-this.firstNonUserCellWidth<this.firstNonUserCellLeft+this.firstUserCellWidth):(p=(d=(h=R.config.win.pageXOffset+v)+this.dockWidth+v)>this.firstUserCellLeft+v,d>this.firstNonUserCellLeft-this.firstUserCellWidth),n=p?this._getRelativeXFromX(h):this._getRelativeXFromX(this.firstUserCellLeft),a.left=n+"px",r.left=n+"px",R.Object.each(this.floatingHeaderRow,function(e,t){c[t]={left:a.left}},this),this.footerRow&&(l.left=this._getRelativeXFromX(this.headerRow.getX()),e=R.config.win.innerHeight,t=R.config.win.pageYOffset,i=e-this._getScrollBarHeight()+t,s=parseInt(this.footerRow.getComputedStyle(w),10)+this.footerRowPosition,m=c[H],C=this.floatingHeaderRow[H],u=i<s&&i>this.firstUserCellBottom?(l.bottom=Math.ceil(s-i)+"px",!0):!(l.bottom="1px"),m&&(m.bottom=l.bottom,m.top=null),c[H]=m),this.gradeItemHeadingContainer&&(this.gradeItemHeadingContainer.setStyles(o),g?this.gradeItemHeadingContainer.addClass(_.FLOATING):this.gradeItemHeadingContainer.removeClass(_.FLOATING)),this.userColumnHeader&&(this.userColumnHeader.setStyles(r),p?this.userColumnHeader.addClass(_.FLOATING):this.userColumnHeader.removeClass(_.FLOATING)),this.userColumn&&(this.userColumn.setStyles(a),p?this.userColumn.addClass(_.FLOATING):this.userColumn.removeClass(_.FLOATING)),this.footerRow&&(this.footerRow.setStyles(l),u?this.footerRow.addClass(_.FLOATING):this.footerRow.removeClass(_.FLOATING)),R.Object.each(c,function(e,t){this.floatingHeaderRow[t]&&this.floatingHeaderRow[t].setStyles(e)},this),R.Object.each(this.floatingHeaderRow,function(e,t){this.floatingHeaderRow[t]&&(f?this.floatingHeaderRow[t].addClass(_.FLOATING):this.floatingHeaderRow[t].removeClass(_.FLOATING))},this),C&&(f?C.addClass(_.FLOATING):C.removeClass(_.FLOATING))},_handleResizeEvent:function(){var o,r,a,e,l,n,d;this._calculateCellPositions(),this._handleScrollEvent(),o=this.firstUserCell.getComputedStyle(h),r=R.all(u),this.userColumnHeader.one(".cell").setStyle("width",o),this.userColumn.all(".cell").each(function(e,t){var i,s=r.item(t).getComputedStyle(w);0!==R.UA.ie&&(s=((i=r.item(t)).getDOMNode?i.getDOMNode().getBoundingClientRect().height:i.get("offsetHeight"))-(parseInt(i.getComputedStyle("marginTop"),10)+parseInt(i.getComputedStyle("marginBottom"),10))-(parseInt(i.getComputedStyle("paddingTop"),10)+parseInt(i.getComputedStyle("paddingBottom"),10))-(parseInt(i.getComputedStyle("borderTopWidth"),10)+parseInt(i.getComputedStyle("borderBottomWidth"),10))),e.setStyles({width:o,height:s})},this),a=this.gradeItemHeadingContainer.all(".cell"),e=R.all(p),l=this.headerRow.getX(),n=0,e.each(function(e,t){var i,s=a.item(t);n+=e.get(g),i={width:e.getComputedStyle(h),left:e.getX()-l+"px"},s.setStyles(i)}),this.footerRow&&0!==(d=this.footerRow.all(".cell")).size()&&R.all(t).each(function(e,t){var i=d.item(t),s={width:e.getComputedStyle(h),left:e.getX()-l+"px"};i.setStyles(s)}),R.Object.each(this.floatingHeaderRow,function(e){e.one("div").setStyle("width",o)},this),this.gradeItemHeadingContainer.setStyle("width",n)}},R.Base.mix(R.M.gradereport_grader.ReportTable,[d])},"@VERSION@",{requires:["base","node","event","handlebars","overlay","event-hover"]});