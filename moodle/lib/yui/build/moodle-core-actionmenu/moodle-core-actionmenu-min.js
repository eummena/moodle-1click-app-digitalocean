YUI.add("moodle-core-actionmenu",function(e,t){var n,s=e.one(e.config.doc.body),o="action-menu-shown",h={CAN_RECEIVE_FOCUS_SELECTOR:'input:not([type="hidden"]), a[href], button, textarea, select, [tabindex]',MENU:".moodle-actionmenu[data-enhance=moodle-core-actionmenu]",MENUBAR:'[role="menubar"]',MENUITEM:'[role="menuitem"]',MENUCONTENT:".menu[data-rel=menu-content]",MENUCONTENTCHILD:"li a",MENUCHILD:".menu li a",TOGGLE:".toggle-display",KEEPOPEN:'[data-keepopen="1"]',MENUBARITEMS:['[role="menubar"] > [role="menuitem"]','[role="menubar"] > [role="presentation"] > [role="menuitem"]'],MENUITEMS:['> [role="menuitem"]','> [role="presentation"] > [role="menuitem"]']},i="tr",u="br";(n=function(){n.superclass.constructor.apply(this,arguments)}).prototype={dialogue:null,events:[],owner:null,menulink:null,menuChildren:null,firstMenuChild:null,lastMenuChild:null,initializer:function(){e.all(h.MENU).each(this.enhance,this),s.delegate("key",this.moveMenuItem,"down:37,39",h.MENUBARITEMS.join(","),this),s.delegate("click",this.toggleMenu,h.MENU+" "+h.TOGGLE,this),s.delegate("key",this.showIfHidden,"down:enter,38,40",h.MENU+" "+h.TOGGLE,this),s.delegate("key",function(e){e.currentTarget.simulate("click"),e.preventDefault()},"down:32",h.MENUBARITEMS.join(","))},enhance:function(e){var t,n=e.one(h.MENUCONTENT);if(!n)return!1;t=n.getData("align")||this.get("align").join("-"),e.one(h.TOGGLE).set("aria-haspopup",!0),n.set("aria-hidden",!0),n.hasClass("align-"+t)||n.addClass("align-"+t),n.getDOMNode().childElementCount&&e.setAttribute("data-enhanced","1")},moveMenuItem:function(e){var t,n=e.target.ancestor(h.MENUITEM,!0);return 37===e.keyCode?t=this.getMenuItem(n,!0):39===e.keyCode&&(t=this.getMenuItem(n)),t&&t.focus(),this},getMenuItem:function(e,t){var n,i,s,o,u,l=e.ancestor(h.MENUBAR);if(!l)return null;if(!(n=l.all(h.MENUITEMS.join(","))))return null;if(1===(s=n.size()))return null;for(u=1,o=o=0;o<s&&n.item(o)!==e;o++);if(n.item(o)!==e)return null;for(t&&(u=-1);o+=u,(i=n.item(o))&&i.hasAttribute("hidden"););return i},hideMenu:function(e){for(var t in this.dialogue&&(this.dialogue.removeClass("show"),this.dialogue.one(h.MENUCONTENT).set("aria-hidden",!0),this.dialogue=null),this.events)this.events[t].detach&&this.events[t].detach();this.events=[],this.owner&&(this.owner.removeClass(o),this.owner=null),this.menulink&&("click"!=e.type&&this.menulink.focus(),this.menulink=null)},showIfHidden:function(e){var t=e.target.ancestor(h.MENU);return t.hasClass("show")||(e.preventDefault(),this.showMenu(e,t)),this},toggleMenu:function(e){var t=e.target.ancestor(h.MENU),n=t.hasClass("show");e.halt(!0),this.hideMenu(e),n||this.showMenu(e,t)},handleKeyboardEvent:function(e){var t,n,i,s,o,u=function(e){e.preventDefault(),e.stopPropagation()};if(e.currentTarget.ancestor(h.TOGGLE,!0))return(40===e.keyCode||9===e.keyCode&&!e.shiftKey)&&this.firstMenuChild?(this.firstMenuChild.focus(),u(e)):38===e.keyCode&&this.lastMenuChild?(this.lastMenuChild.focus(),u(e)):9===e.keyCode&&e.shiftKey&&(this.hideMenu(e),u(e)),this;if(27===e.keyCode)this.hideMenu(e),u(e);else if(32===e.keyCode)u(e),e.currentTarget.simulate("click");else if(9===e.keyCode)e.target===this.firstMenuChild&&e.shiftKey?(this.hideMenu(e),u(e)):e.target!==this.lastMenuChild||e.shiftKey||this.hideMenu(e)&&(t=this.menulink.next(h.CAN_RECEIVE_FOCUS_SELECTOR))&&(t.focus(),u(e));else if(38===e.keyCode||40===e.keyCode){for(n=!1,s=1,o=i=0;!n&&i<this.menuChildren.size();)this.menuChildren.item(i)===e.currentTarget?n=!0:i++;if(!n)return;for(38===e.keyCode&&(s=-1);(i+=s)<0?i=this.menuChildren.size()-1:i>=this.menuChildren.size()&&(i=0),t=this.menuChildren.item(i),++o<this.menuChildren.size()&&t!==e.currentTarget&&t.hasClass("hidden"););t&&(t.focus(),u(e))}},hideIfOutside:function(e){e.target.ancestor(h.MENUCONTENT,!0)||this.hideMenu(e)},showMenu:function(e,t){var n=t.getData("owner"),i=t.one(h.MENUCONTENT);return this.owner=n?t.ancestor(n):null,(this.dialogue=t).addClass("show"),this.owner?(this.owner.addClass(o),this.menulink=this.owner.one(h.TOGGLE)):this.menulink=e.target.ancestor(h.TOGGLE,!0),this.constrain(i.set("aria-hidden",!1)),this.menuChildren=this.dialogue.all(h.MENUCHILD),0<this.menuChildren.size()&&(this.firstMenuChild=this.menuChildren.item(0),this.lastMenuChild=this.menuChildren.item(this.menuChildren.size()-1),this.firstMenuChild.focus()),this.events.push(s.on("key",this.hideMenu,"esc",this)),this.events.push(s.on("click",this.hideIfOutside,this)),this.events.push(s.delegate("focus",this.hideIfOutside,"*",this)),this.events.push(t.delegate("key",this.handleKeyboardEvent,"down:9, 27, 38, 40, 32",h.MENUCHILD+", "+h.TOGGLE,this)),this.events.push(t.delegate("click",function(e){e.currentTarget.test(h.KEEPOPEN)||this.hideMenu(e)},h.MENUCHILD,this)),!0},constrain:function(e){var t,n,i=e.getData("constraint"),s=e.getX(),o=e.getY(),u=e.get("offsetWidth"),l=e.get("offsetHeight"),h=0,a=0,r="auto",d=null,c=null,M=null,m=null,f=null;if((i=i&&e.ancestor(i))?(t=i.get("offsetWidth"),n=i.get("offsetHeight"),h=i.getX(),a=i.getY(),r=i.getStyle("overflow")||"auto"):(t=e.get("docWidth"),n=e.get("docHeight")),t<u?(d=u=t,M=s=h):s<h?M=s=h:h+t<=s+u&&(M=h+t-u),n<l&&"hidden"===r.toLowerCase()&&(c=l=n,e.setStyle("overflow","auto")),a<=o&&a+n<o+l){m=a+n-l;try{f=e.getStyle("boxShadow").replace(/.*? (\d+)px \d+px$/,"$1"),new RegExp(/^\d+$/).test(f)&&f<m-a&&(m-=f)}catch(E){}}null!==M&&e.setX(M),null!==m&&e.setY(m),null!==d&&e.setStyle("width",d.toString()+"px"),null!==c&&e.setStyle("height",c.toString()+"px")}},e.extend(n,e.Base,n.prototype,{NAME:"moodle-core-actionmenu",ATTRS:{align:{value:[i,u]}}}),M.core=M.core||{},M.core.actionmenu=M.core.actionmenu||{},M.core.actionmenu.instance=null,M.core.actionmenu.init=M.core.actionmenu.init||function(e){M.core.actionmenu.instance=M.core.actionmenu.instance||new n(e)},M.core.actionmenu.newDOMNode=function(e){if(null===M.core.actionmenu.instance)return!0;e.all(h.MENU).each(M.core.actionmenu.instance.enhance,M.core.actionmenu.instance)}},"@VERSION@",{
requires:["base","event","node-event-simulate"]});