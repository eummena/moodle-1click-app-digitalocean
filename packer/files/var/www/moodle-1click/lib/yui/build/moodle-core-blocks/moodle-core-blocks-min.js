YUI.add("moodle-core-blocks",function(g,e){var o,a,r="/lib/ajax/blocks.php",d="block",c="block-region",l="block_adminblock",u="editing_move",t="header",p="region-content",h="skip-block",i="skip-block-to",_="page-my-index",b="region-main",n="blocks-moving",f={DRAGHANDLE:"."+t+" .commands .moodle-core-dragdrop-draghandle"},s=function(){s.superclass.constructor.apply(this,arguments)};g.extend(s,M.core.dragdrop,{skipnodetop:null,skipnodebottom:null,dragsourceregion:null,initializer:function(){var e,o,t,i,n,s,r;if(this.groups=["block"],this.samenodeclass=d,this.parentnodeclass=p,0<(e=g.Node.all("body#"+_+" #"+b+" > ."+p)).size()&&((o=e.item(0)).addClass(c),o.set("id",p),o.one("div").addClass(p)),0===(t=g.Node.all("div."+c)).size())return!1;t.size()!==this.get("regions").length&&(i=g.Node.create("<div></div>").addClass(c),n=g.Node.create("<div></div>").addClass(p),i.appendChild(n),s=t.filter("#region-pre"),r=t.filter("#region-post"),0===s.size()&&1===r.size()?(i.setAttrs({id:"region-pre"}),r.item(0).insert(i,"before"),t.unshift(i)):0===r.size()&&1===s.size()&&(i.setAttrs({id:"region-post"}),s.item(0).insert(i,"after"),t.push(i))),t.each(function(e){var o;new g.DD.Drop({node:e.one("div."+p),groups:this.groups,padding:"40 240 40 240"}),(o=new g.DD.Delegate({container:e,nodes:"."+d,target:!0,handles:[f.DRAGHANDLE],invalid:".block-hider-hide, .block-hider-show, .moveto",dragConfig:{groups:this.groups}})).dd.plug(g.Plugin.DDProxy,{moveOnEnd:!1}),o.dd.plug(g.Plugin.DDWinScroll),e.all("."+d).each(function(e){var o=e.one("a."+u);o&&(o.replace(this.get_drag_handle(o.getAttribute("title"),"","iconsmall",!0)),e.one(f.DRAGHANDLE).setStyle("cursor","move"))},this)},this)},get_block_id:function(e){return Number(e.get("id").replace(/inst/i,""))},get_block_region:function(e){var o=e.ancestor("div."+c).get("id").replace(/region-/i,"");return-1===g.Array.indexOf(this.get("regions"),o)?(window.right_to_left()&&("post"===o?o="pre":"pre"===o&&(o="post")),"side-"+o):o},get_region_id:function(e){return e.get("id").replace(/region-/i,"")},drag_start:function(e){var o=e.target;this.dragsourceregion=o.get("node").ancestor("div."+c),o.get("node").previous()&&o.get("node").previous().hasClass(h)&&(this.skipnodetop=o.get("node").previous()),o.get("node").next()&&o.get("node").next().hasClass(i)&&(this.skipnodebottom=o.get("node").next()),g.one("body").addClass(n)},drop_over:function(e){var o,t,i=e.drag.get("node"),n=e.drop.get("node");if(n.hasClass(this.parentnodeclass)&&n.one("."+l)&&n.one("."+l).next("."+d)&&n.prepend(i),this.dragsourceregion.contains(n))return!1;o=g.one("body"),t=this.get_region_id(this.dragsourceregion),o.hasClass("side-"+t+"-only")&&o.removeClass("side-"+t+"-only"),t=this.get_region_id(n.ancestor("div."+c)),0===this.dragsourceregion.all("."+d).size()&&this.dragsourceregion.get("id").match(/(region-pre|region-post)/i)&&(o.hasClass("side-"+t+"-only")||o.addClass("side-"+t+"-only"))},drag_end:function(){this.skipnodetop=null,this.skipnodebottom=null,this.dragsourceregion=null,g.one("body").removeClass(n)},drag_dropmiss:function(e){this.drop_hit(e)},drop_hit:function(i){var n,e,o=i.drag,t=o.get("node"),s=i.drop.get("node");t.previous()&&t.previous().hasClass(h)&&t.insert(t.previous(),"after"),this.skipnodetop&&t.insert(this.skipnodetop,"before"),this.skipnodebottom&&t.insert(this.skipnodebottom,"after"),n=M.util.add_lightbox(g,t),e={sesskey:M.cfg.sesskey,courseid:this.get("courseid"),pagelayout:this.get("pagelayout"),pagetype:this.get("pagetype"),subpage:this.get("subpage"),contextid:this.get("contextid"),action:"move",bui_moveid:this.get_block_id(t),bui_newregion:this.get_block_region(s)},this.get("cmid")&&(e.cmid=this.get("cmid")),t.next("."+this.samenodeclass)&&!t.next("."+this.samenodeclass).hasClass(l)&&(e.bui_beforeid=this.get_block_id(t.next("."+this.samenodeclass))),g.io(M.cfg.wwwroot+r,{method:"POST",data:e,on:{start:function(){n.show()},success:function(e,o){window.setTimeout(function(){n.hide()},250);try{var t=g.JSON.parse(o.responseText);t.error&&new M.core.ajaxException(t)}catch(i){}},failure:function(e,o){this.ajax_failure(o),n.hide()}},context:this})}},{NAME:"core-blocks-dragdrop",ATTRS:{courseid:{value:null},cmid:{value:null},contextid:{value:null},pagelayout:{value:null},pagetype:{value:null},subpage:{value:null},regions:{value:null}}}),M.core=M.core||{},M.core.blockdraganddrop=M.core.blockdraganddrop||{},M.core.blockdraganddrop._isusingnewblocksmethod=null,M.core.blockdraganddrop.is_using_blocks_render_method=function(){var e,o;return null===this._isusingnewblocksmethod&&(e=g.all(".block-region[data-blockregion]").size(),o=g.all(".block-region").size(),this._isusingnewblocksmethod=o===e),this._isusingnewblocksmethod},M.core.blockdraganddrop.init=function(e){new(this.is_using_blocks_render_method()?o:s)(e)},M.core_blocks=M.core_blocks||{},M.core_blocks.init_dragdrop=function(e){M.core.blockdraganddrop.init(e)},(o=function(){o.superclass.constructor.apply(this,arguments)}).prototype={skipnodetop:null,skipnodebottom:null,regionobjects:{},initializer:function(){var e,o,t,i,n,s=this.get("regions"),r=0;for(r in this.groups=["block"],this.samenodeclass=d,this.parentnodeclass=c,this.detectkeyboarddirection=!0,0<(i=g.Node.all("body#"+_+" #"+b+" > ."+p)).size()&&((n=i.item(0)).addClass(c),n.set("id",p),n.one("div").addClass(p)),s)o=s[r],e=new a({manager:this,region:o,node:g.one("#block-region-"+o)}),this.regionobjects[o]=e,new g.DD.Drop({node:e.get_droptarget(),groups:this.groups,padding:"40 240 40 240"}),(t=new g.DD.Delegate({container:e.get_droptarget(),nodes:"."+d,target:!0,handles:[f.DRAGHANDLE],invalid:".block-hider-hide, .block-hider-show, .moveto, .block_fake",dragConfig:{groups:this.groups}})).dd.plug(g.Plugin.DDProxy,{moveOnEnd:!1}),t.dd.plug(g.Plugin.DDWinScroll),g.DD.DDM.on("ddm:start",this.enable_all_regions,this),e.change_block_move_icons(this)},get_block_id:function(e){return Number(e.get("id").replace(/inst/i,""))},get_block_region:function(e){return e.test("[data-blockregion]")||(
e=e.ancestor("[data-blockregion]")),e.getData("blockregion")},get_region_object:function(e){return this.regionobjects[this.get_block_region(e)]},enable_all_regions:function(){var e,o=g.DD.DDM.activeDrag.get("groups");if(o&&-1!==g.Array.indexOf(o,"block"))for(e in this.regionobjects)this.regionobjects.hasOwnProperty(e)&&this.regionobjects[e].enable()},disable_regions_if_required:function(){var e=0;for(e in this.regionobjects)this.regionobjects[e].disable_if_required()},drag_start:function(e){var o=e.target;o.get("node").previous()&&o.get("node").previous().hasClass(h)&&(this.skipnodetop=o.get("node").previous()),o.get("node").next()&&o.get("node").next().hasClass(i)&&(this.skipnodebottom=o.get("node").next())},drop_over:function(e){var o=e.drag.get("node"),t=e.drop.get("node");t.hasClass(p)&&t.one("."+l)&&t.one("."+l).next("."+d)&&t.prepend(o)},drop_end:function(){this.skipnodetop=null,this.skipnodebottom=null,this.disable_regions_if_required()},drag_dropmiss:function(e){this.drop_hit(e)},drop_hit:function(i){var n,e,o=i.drag.get("node"),t=i.drop.get("node");o.previous()&&o.previous().hasClass(h)&&o.insert(o.previous(),"after"),this.skipnodetop&&o.insert(this.skipnodetop,"before"),this.skipnodebottom&&o.insert(this.skipnodebottom,"after"),n=M.util.add_lightbox(g,o),e={sesskey:M.cfg.sesskey,courseid:this.get("courseid"),pagelayout:this.get("pagelayout"),pagetype:this.get("pagetype"),subpage:this.get("subpage"),contextid:this.get("contextid"),action:"move",bui_moveid:this.get_block_id(o),bui_newregion:this.get_block_region(t)},this.get("cmid")&&(e.cmid=this.get("cmid")),o.next("."+d)&&!o.next("."+d).hasClass(l)&&(e.bui_beforeid=this.get_block_id(o.next("."+d))),g.io(M.cfg.wwwroot+r,{method:"POST",data:e,on:{start:function(){n.show()},success:function(e,o){window.setTimeout(function(){n.hide()},250);try{var t=g.JSON.parse(o.responseText);t.error&&new M.core.ajaxException(t)}catch(i){}},failure:function(e,o){this.ajax_failure(o),n.hide()},complete:function(){this.disable_regions_if_required()}},context:this})}},g.extend(o,M.core.dragdrop,o.prototype,{NAME:"core-blocks-dragdrop-manager",ATTRS:{courseid:{value:null},cmid:{value:null},contextid:{value:null},pagelayout:{value:null},pagetype:{value:null},subpage:{value:null},regions:{value:[]}}}),(a=function(){a.superclass.constructor.apply(this,arguments)}).prototype={initializer:function(){var e,o,t,i=this.get("node");i=i||this.create_and_add_node(),e=g.one("body"),o=0<i.all("."+d).size(),t=this.get_has_region_class(),this.set("hasblocks",o),e.hasClass(t)||e.addClass(t),e.addClass(o?this.get_used_region_class():this.get_empty_region_class()),e.removeClass(o?this.get_empty_region_class():this.get_used_region_class())},create_and_add_node:function(){var e,o,t,i=g.Node.create,n=this.get("region"),s=i('<div id="block-region-'+n+'" data-droptarget="1"></div>').addClass(c).setData("blockregion",n),r=this.get("manager").get("regions"),a=!1,d=!1,l=!1;for(e in r)r[e].match(/(pre|left)/)?a=r[e]:r[e].match(/(post|right)/)&&(d=r[e]);return!1!==a&&!1!==d&&(n===a?(t=g.one("#block-region-"+d))&&(t.insert(s,"before"),l=!0):(o=g.one("#block-region-"+a))&&(o.insert(s,"after"),l=!0)),!1===l&&g.one("body").append(s),this.set("node",s),s},change_block_move_icons:function(o){var t;this.get("node").all("."+d+" a."+u).each(function(e){e.setStyle("cursor","move"),t=o.get_drag_handle(e.getAttribute("title"),"","icon",!0),e.replace(t)})},get_has_region_class:function(){return"has-region-"+this.get("region")},get_empty_region_class:function(){return"empty-region-"+this.get("region")},get_used_region_class:function(){return"used-region-"+this.get("region")},get_droptarget:function(){var e=this.get("node");return e.test('[data-droptarget="1"]')?e:e.one('[data-droptarget="1"]')},enable:function(){g.one("body").addClass(this.get_used_region_class()).removeClass(this.get_empty_region_class())},disable_if_required:function(){0===this.get("node").all("."+d).size()&&g.one("body").addClass(this.get_empty_region_class()).removeClass(this.get_used_region_class())}},g.extend(a,g.Base,a.prototype,{NAME:"core-blocks-dragdrop-blockregion",ATTRS:{manager:{writeOnce:"initOnly",validator:function(e){return g.Lang.isObject(e)&&e instanceof o}},region:{writeOnce:"initOnly",validator:function(e){return g.Lang.isString(e)}},node:{validator:function(e){return g.Lang.isObject(e)||g.Lang.isNull(e)}},hasblocks:{value:!1,validator:function(e){return g.Lang.isBoolean(e)}}}})},"@VERSION@",{requires:["base","node","io","dom","dd","dd-scroll","moodle-core-dragdrop","moodle-core-notification"]});