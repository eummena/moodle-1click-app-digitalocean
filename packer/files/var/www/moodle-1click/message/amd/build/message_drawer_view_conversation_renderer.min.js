define ("core_message/message_drawer_view_conversation_renderer",["jquery","core/notification","core/str","core/templates","core/user_date","core_message/message_drawer_view_conversation_constants","core/aria"],function(a,b,c,d,e,f,g){var h=f.SELECTORS,i=f.TEMPLATES,j=f.CONVERSATION_TYPES,k=function(a){return a.find(h.CONTENT_MESSAGES_CONTAINER)},l=function(a){k(a).removeClass("hidden")},m=function(a){k(a).addClass("hidden")},n=function(a){return a.find(h.SELF_CONVERSATION_MESSAGE_CONTAINER)},o=function(a){return n(a).addClass("hidden")},p=function(a){return a.find(h.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER)},q=function(a){return p(a).addClass("hidden")},r=function(a){return a.find(h.CONTENT_MESSAGES_FOOTER_CONTAINER)},s=function(a){r(a).removeClass("hidden")},t=function(a){r(a).addClass("hidden")},u=function(a){return a.find(h.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER)},v=function(a){u(a).removeClass("hidden")},w=function(a){u(a).addClass("hidden")},x=function(a){return a.find(h.PLACEHOLDER_CONTAINER)},y=function(a){x(a).removeClass("hidden")},z=function(a){x(a).addClass("hidden")},A=function(a){return a.find(h.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER)},B=function(a){A(a).removeClass("hidden")},C=function(a){A(a).addClass("hidden")},D=function(a){return a.find(h.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER)},E=function(a){D(a).removeClass("hidden")},F=function(a){D(a).addClass("hidden")},G=function(a){return a.find(h.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER)},H=function(a){G(a).removeClass("hidden")},I=function(a){G(a).addClass("hidden")},J=function(a){Q(a);T(a);W(a)},K=function(a){t(a);w(a);z(a);C(a);F(a);I(a)},L=function(a){return a.find(h.CONTENT_PLACEHOLDER_CONTAINER)},M=function(a){L(a).removeClass("hidden")},N=function(a){L(a).addClass("hidden")},O=function(a){return a.find(h.HEADER)},P=function(a){O(a).removeClass("hidden")},Q=function(a){O(a).addClass("hidden")},R=function(a){return a.find(h.HEADER_EDIT_MODE)},S=function(a){R(a).removeClass("hidden")},T=function(a){R(a).addClass("hidden")},U=function(a){return a.find(h.HEADER_PLACEHOLDER_CONTAINER)},V=function(a){U(a).removeClass("hidden")},W=function(a){U(a).addClass("hidden")},X=function(a){return a.find(h.EMOJI_PICKER_CONTAINER)},Y=function(a){return a.find(h.EMOJI_AUTO_COMPLETE_CONTAINER)},Z=function(a,b){var c=k(a);return c.find("[data-message-id=\""+b+"\"]")},$=function(a,b){var c=k(a);return c.find("[data-day-id=\""+b+"\"]")},_=function(a){return a.find(h.MORE_MESSAGES_LOADING_ICON_CONTAINER)},aa=function(a){_(a).removeClass("hidden")},ba=function(a){_(a).addClass("hidden")},ca=function(a){return a.find(h.CONFIRM_DIALOGUE_CONTAINER)},da=function(a){var b=ca(a),c=b.siblings(":not(.hidden)");g.hide(c.get());c.attr("data-confirm-dialogue-hidden",!0);b.removeClass("hidden")},ea=function(a){var b=ca(a),c=b.siblings("[data-confirm-dialogue-hidden=\"true\"]");g.unhide(c.get());c.removeAttr("data-confirm-dialogue-hidden");b.addClass("hidden")},fa=function(a,b){R(a).find(h.MESSAGES_SELECTED_COUNT).text(b)},ga=function(a,b){return a.map(function(a){return{id:a.id,isread:a.isRead,fromloggedinuser:a.fromLoggedInUser,userfrom:a.userFrom,text:a.text,formattedtime:a.timeCreated?b[a.timeCreated]:null}})},ha=function(b,c,e,f,g){var h=k(c),j=f.map(function(a){return d.render(i.DAY,{timestamp:a.value.timestamp,messages:ga(a.value.messages,g)})});return a.when.apply(a,j).then(function(){f.forEach(function(b,d){j[d].then(function(d){if(b.before){var e=$(c,b.before.timestamp);return a(d).insertBefore(e)}else{return h.append(d)}}).catch(function(){})})})},ia=function(b,c,e,f,g){var j=f.map(function(a){return a.value}),k=ga(j,g);return d.render(i.MESSAGES,{messages:k}).then(function(b){var d=a(b);f.forEach(function(a){var b=d.find("[data-message-id=\""+a.value.id+"\"]");if(a.before){var e=Z(c,a.before.id);return b.insertBefore(e)}else{var f=$(c,a.day.timestamp),g=f.find(h.DAY_MESSAGES_CONTAINER);return g.append(b)}})})},ja=function(a,b,c,d,e){d.forEach(function(a){var c=a.before,d=a.after,f=Z(b,c.id);if(c.id!=d.id){f.attr("data-message-id",d.id)}if(c.timeCreated!=d.timeCreated){var i=e[d.timeCreated];f.find(h.LOADING_ICON_CONTAINER).addClass("hidden");f.find(h.TIME_CREATED).text(i).removeClass("hidden")}if(c.sendState!=d.sendState){var j=f.find(h.LOADING_ICON_CONTAINER),k=f.find(h.TIME_CREATED),l=f.find(h.RETRY_SEND);j.addClass("hidden");g.hide(j.get());k.addClass("hidden");g.hide(k.get());l.addClass("hidden");g.hide(l.get());f.removeClass("border border-danger");switch(d.sendState){case"pending":j.removeClass("hidden");g.unhide(j.get());break;case"error":l.removeClass("hidden");g.unhide(l.get());f.addClass("border border-danger");break;case"sent":k.removeClass("hidden");g.unhide(k.get());break;}}if(c.text!=d.text){f.find(h.TEXT_CONTAINER).html(d.text)}if(c.errorMessage!=d.errorMessage){var m=f.find(h.ERROR_MESSAGE_CONTAINER),a=m.find(h.ERROR_MESSAGE);if(d.errorMessage){m.removeClass("hidden");g.unhide(m.get());a.text(d.errorMessage)}else{m.addClass("hidden");g.unhide(m.get());a.text("")}}})},ka=function(a,b){b.forEach(function(b){$(a,b.timestamp).remove()})},la=function(a,b){b.forEach(function(b){Z(a,b.id).remove()})},ma=function(b,d,f,g){var h=[],i=0<g.days.add.length,j=0<g.messages.add.length,k=0<g.messages.update.length,l=[],m=a.Deferred().resolve({}).promise();if(i){l=l.concat(g.days.add.reduce(function(a,b){return a.concat(b.value.messages.reduce(function(a,b){if(b.timeCreated){a.push(b.timeCreated)}return a},[]))},[]))}if(j){l=l.concat(g.messages.add.reduce(function(a,b){if(b.value.timeCreated){a.push(b.value.timeCreated)}return a},[]))}if(k){l=l.concat(g.messages.update.reduce(function(a,b){if(b.before.timeCreated!=b.after.timeCreated){a.push(b.after.timeCreated)}return a},[]))}if(l.length){m=c.get_string("strftimetime24","core_langconfig").then(function(a){var b=l.map(function(b){return{timestamp:b,format:a}});return e.get(b)}).then(function(a){return l.reduce(function(b,c,d){b[c]=a[d];return b},{})})}if(i){h.push(m.then(function(a){return ha(b,d,f,g.days.add,a)}))}if(j){h.push(m.then(function(a){return ia(b,d,f,g.messages.add,a)}))}if(k){h.push(m.then(function(a){return ja(b,d,f,g.messages.update,a)}))}if(0<g.days.remove.length){ka(d,g.days.remove)}if(0<g.messages.remove.length){la(d,g.messages.remove)}return a.when.apply(a,h)},na=function(a,b,c,e){var f=O(a),g=i.HEADER_PUBLIC;e.context.showrouteback="false"===a.attr("data-from-panel");if(e.type==j.PRIVATE){g=e.showControls?i.HEADER_PRIVATE:i.HEADER_PRIVATE_NO_CONTROLS}else if(e.type==j.SELF){g=i.HEADER_SELF}return d.render(g,e.context).then(function(a,b){d.replaceNodeContents(f,a,b)})},oa=function(a,b,d,e){K(d);switch(e.type){case"placeholder":return y(d);case"add-contact":return c.get_strings([{key:"requirecontacttomessage",component:"core_message",param:e.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:e.user.fullname}]).then(function(a){var b=a[1],c=a[0],e=A(d);e.find(h.TITLE).text(b);e.find(h.TEXT).text(c);B(d);return a});case"edit-mode":return v(d);case"content":return s(d);case"unblock":return E(d);case"unable-to-message":return H(d);}return!0},pa=function(a,b,c,d){var e=k(b),f=Z(b,d),g=f.position();if(g){var h=e.scrollTop()+g.top;e.scrollTop(h)}},qa=function(a,b,c,d){if(d){Q(a);V(a)}else{P(a);W(a)}},ra=function(a,b,c,d){if(d){m(b);M(b)}else{l(b);N(b)}},sa=function(a,b,c,d){if(d){aa(b)}else{ba(b)}},ta=function(a,b,c,d){var e=X(c);if(d){e.removeClass("hidden");g.unhide(e.get());e.find(h.EMOJI_PICKER_SEARCH_INPUT).focus()}else{e.addClass("hidden");g.hide(e.get())}},ua=function(a,b,c,d){var e=Y(c);if(d){e.removeClass("hidden");g.unhide(e.get())}else{e.addClass("hidden");g.hide(e.get())}},va=function(b,c,d,e,f,g,i,j,k){var l=ca(c),m=e.map(function(a){return l.find(a)}),n=l.find(h.CONFIRM_DIALOGUE_CANCEL_BUTTON),o=l.find(h.CONFIRM_DIALOGUE_OKAY_BUTTON),p=l.find(h.CONFIRM_DIALOGUE_TEXT),q=l.find(h.CONFIRM_DIALOGUE_HEADER);l.find("button").addClass("hidden");if(i){n.removeClass("hidden")}else{n.addClass("hidden")}if(k){o.removeClass("hidden")}else{o.addClass("hidden")}if(g){q=a("<h3 class=\"h6\" data-region=\"dialogue-header\"></h3>");q.text(g);var r=l.find(h.CONFIRM_DIALOGUE);r.prepend(q)}else if(q.length){q.remove()}m.forEach(function(a){a.removeClass("hidden")});p.text(f);da(d);da(c);if(!j){da(b)}l.find(h.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()},wa=function(a,b,c){var d=ca(b),e=d.find(h.CONFIRM_DIALOGUE_CANCEL_BUTTON),f=d.find(h.CONFIRM_DIALOGUE_OKAY_BUTTON),g=d.find(h.CONFIRM_DIALOGUE_TEXT),i=d.find(h.CONFIRM_DIALOGUE_HEADER);Fa(b);ea(b);ea(c);ea(a);d.find("button").addClass("hidden");e.removeClass("hidden");f.removeClass("hidden");g.text("");if(i.length){i.remove()}a.find(h.CAN_RECEIVE_FOCUS).first().focus();return!0},xa=function(a,b,d,e){if(e){if(e.canmessageevenifblocked){return c.get_string("cantblockuser","core_message",e.fullname).then(function(c){return va(a,b,d,[],c,"",!1,!1,!0)})}else{return c.get_string("blockuserconfirm","core_message",e.fullname).then(function(c){return va(a,b,d,[h.ACTION_CONFIRM_BLOCK],c,"",!0,!1)})}}else{return wa(a,b,d)}},ya=function(a,b,d,e){if(e){return c.get_string("unblockuserconfirm","core_message",e.fullname).then(function(c){return va(a,b,d,[h.ACTION_CONFIRM_UNBLOCK],c,"",!0,!1)})}else{return wa(a,b,d)}},za=function(a,b,d,e){if(e){return c.get_string("addcontactconfirm","core_message",e.fullname).then(function(c){return va(a,b,d,[h.ACTION_CONFIRM_ADD_CONTACT],c,"",!0,!1)})}else{return wa(a,b,d)}},Aa=function(a,b,d,e){if(e){return c.get_string("removecontactconfirm","core_message",e.fullname).then(function(c){return va(a,b,d,[h.ACTION_CONFIRM_REMOVE_CONTACT],c,"",!0,!1)})}else{return wa(a,b,d)}},Ba=function(a,b,d,e){var f=null;if(e.type==j.SELF){f="deleteselectedmessagesconfirmselfconversation"}else{if(e.canDeleteMessagesForAllUsers){Ea(b);f="deleteforeveryoneselectedmessagesconfirm"}else{f="deleteselectedmessagesconfirm"}}if(e.show){return c.get_string(f,"core_message").then(function(c){return va(a,b,d,[h.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],c,"",!0,!1)})}else{return wa(a,b,d)}},Ca=function(a,b,d,e){var f=null;if(e==j.SELF){f="deleteallselfconfirm"}else if(e){f="deleteallconfirm"}if(f){return c.get_string(f,"core_message").then(function(c){return va(a,b,d,[h.ACTION_CONFIRM_DELETE_CONVERSATION],c,"",!0,!1)})}else{return wa(a,b,d)}},Da=function(a,b,d,e){if(e){return c.get_string("userwouldliketocontactyou","core_message",e.fullname).then(function(c){var e=[h.ACTION_ACCEPT_CONTACT_REQUEST,h.ACTION_DECLINE_CONTACT_REQUEST];return va(a,b,d,e,c,"",!1,!0)})}else{return wa(a,b,d)}},Ea=function(a){var b=ca(a),c=b.find(h.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);c.removeClass("hidden")},Fa=function(a){var b=ca(a),c=b.find(h.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER),d=b.find(h.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE);d.prop("checked",!1);c.addClass("hidden")},Ga=function(a,b,c,d){if(d){a.find(h.ACTION_REQUEST_BLOCK).addClass("hidden");a.find(h.ACTION_REQUEST_UNBLOCK).removeClass("hidden")}else{a.find(h.ACTION_REQUEST_BLOCK).removeClass("hidden");a.find(h.ACTION_REQUEST_UNBLOCK).addClass("hidden")}},Ha=function(a,b,c,d){var e=a.find(h.FAVOURITE_ICON_CONTAINER),f=a.find(h.ACTION_CONFIRM_FAVOURITE),g=a.find(h.ACTION_CONFIRM_UNFAVOURITE);switch(d){case"hide":e.addClass("hidden");f.addClass("hidden");g.addClass("hidden");break;case"show-add":e.addClass("hidden");f.removeClass("hidden");g.addClass("hidden");break;case"show-remove":e.removeClass("hidden");f.addClass("hidden");g.removeClass("hidden");break;}},Ia=function(a,b,c,d){var e=a.find(h.MUTED_ICON_CONTAINER),f=a.find(h.ACTION_CONFIRM_MUTE),g=a.find(h.ACTION_CONFIRM_UNMUTE);switch(d){case"hide":e.addClass("hidden");f.addClass("hidden");g.addClass("hidden");break;case"show-mute":e.addClass("hidden");f.removeClass("hidden");g.addClass("hidden");break;case"show-unmute":e.removeClass("hidden");f.addClass("hidden");g.removeClass("hidden");break;}},Ja=function(a,b,c,d){var e=a.find(h.ACTION_REQUEST_ADD_CONTACT),f=a.find(h.ACTION_REQUEST_REMOVE_CONTACT);switch(d){case"pending-contact":e.addClass("hidden");f.addClass("hidden");break;case"contact":e.addClass("hidden");f.removeClass("hidden");break;case"non-contact":e.removeClass("hidden");f.addClass("hidden");break;}},Ka=function(a,b,c,d){var e=ca(b),f=e.find("button"),g=e.find(h.CONFIRM_DIALOGUE_BUTTON_TEXT),i=e.find(h.LOADING_ICON_CONTAINER);if(d){f.prop("disabled",!0);g.addClass("hidden");i.removeClass("hidden")}else{f.prop("disabled",!1);g.removeClass("hidden");i.addClass("hidden")}},La=function(a,b,c,d){var e=null;if(d){e=b.find(h.MESSAGE_NOT_SELECTED);e.find(h.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden");Q(a);S(a)}else{e=k(b);e.find(h.MESSAGE_NOT_SELECTED_ICON).addClass("hidden");e.find(h.MESSAGE_SELECTED_ICON).addClass("hidden");P(a);T(a)}},Ma=function(a,b,c,d){var e=0<d.count;if(d.add.length){d.add.forEach(function(a){var c=Z(b,a);c.find(h.MESSAGE_NOT_SELECTED_ICON).addClass("hidden");c.find(h.MESSAGE_SELECTED_ICON).removeClass("hidden");c.attr("aria-checked",!0)})}if(d.remove.length){d.remove.forEach(function(a){var c=Z(b,a);if(e){c.find(h.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden")}c.find(h.MESSAGE_SELECTED_ICON).addClass("hidden");c.attr("aria-checked",!1)})}fa(a,d.count)},Na=function(a,b,d,e){if(e.show&&!e.hasMessages){return c.get_strings([{key:"requirecontacttomessage",component:"core_message",param:e.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:e.user.fullname}]).then(function(c){var e=c[1],f=c[0];return va(a,b,d,[h.ACTION_REQUEST_ADD_CONTACT],f,e,!1,!0)})}else{return wa(a,b,d)}},Oa=function(a,b,c,d){var e=n(b);if(d){e.removeClass("hidden")}else{e.addClass("hidden")}return!0},Pa=function(a,b,d,e){var f=p(b);if(e){return c.get_string("yourcontactrequestpending","core_message",e).then(function(a){f.find(h.TEXT).text(a);f.removeClass("hidden");return a})}else{f.addClass("hidden");return!0}},Qa=function(a,b,c){wa(a,b,c);q(b);o(b);J(a);V(a);K(c);y(c);return!0};return{render:function render(c,d,e,f){var g=[{reset:Qa},{conversation:ma,header:na,footer:oa,confirmBlockUser:xa,confirmUnblockUser:ya,confirmAddContact:za,confirmRemoveContact:Aa,confirmDeleteSelectedMessages:Ba,confirmDeleteConversation:Ca,confirmContactRequest:Da,requireAddContact:Na,selfConversationMessage:Oa,contactRequestSent:Pa},{loadingMembers:qa,loadingFirstMessages:ra,loadingMessages:sa,isBlocked:Ga,isContact:Ja,isFavourite:Ha,isMuted:Ia,loadingConfirmAction:Ka,inEditMode:La,showEmojiPicker:ta,showEmojiAutoComplete:ua},{scrollToMessage:pa,selectedMessages:Ma}],h=function(a){var b=[];for(var g in f){if(a.hasOwnProperty(g)){var h=a[g],i=f[g];b.push(h(c,d,e,i))}}return b},i=h(g[0]);i=i.concat(h(g[1]));return a.when.apply(a,i).then(function(){for(var a=2;a<g.length;a++){h(g[a])}}).catch(b.exception)}}});
//# sourceMappingURL=message_drawer_view_conversation_renderer.min.js.map
