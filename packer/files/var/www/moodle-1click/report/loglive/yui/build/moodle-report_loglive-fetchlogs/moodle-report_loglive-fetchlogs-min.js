YUI.add("moodle-report_loglive-fetchlogs",function(l,e){function t(){t.superclass.constructor.apply(this,arguments)}var i="newrow",a={NEWROW:"."+i,TBODY:".flexible tbody",PAUSEBUTTON:"#livelogs-pause-button",SPINNER:"."+"spinner"};l.extend(t,l.Base,{callBack:{},spinner:{},pauseButton:{},initializer:function(){0===this.get("page")&&(this.callBack=l.later(1e3*this.get("interval"),this,this.fetchRecentLogs,null,!0)),this.spinner=l.one(a.SPINNER),this.pauseButton=l.one(a.PAUSEBUTTON),this.spinner.hide(),l.one(a.PAUSEBUTTON).on("click",this.toggleUpdate,this)},fetchRecentLogs:function(){var e,t,i;this.spinner.show(),e={logreader:this.get("logreader"),since:this.get("since"),page:this.get("page"),id:this.get("courseid")},t={method:"get",context:this,on:{complete:this.updateLogTable},data:e},i=M.cfg.wwwroot+"/report/loglive/loglive_ajax.php",l.io(i,t)},updateLogTable:function(e,t){var i,n,o,s;l.later(600,this,"hideLoadingIcon");try{if((i=l.JSON.parse(t.responseText)).error)return l.use("moodle-core-notification-ajaxexception",function(){return new M.core.ajaxException(i)}),this}catch(r){return l.use("moodle-core-notification-exception",function(){return new M.core.exception(r)}),this}this.set("since",i.until),n=i.logs,s=null,(o=l.one(a.TBODY))&&n&&((s=o.get("firstChild"))&&o.insertBefore(n,s),o.get("children").slice(this.get("perpage")).remove(),l.later(5e3,this,"removeHighlight",i.until))},removeHighlight:function(e){l.all(".time"+e).removeClass(i)},hideLoadingIcon:function(){this.spinner.hide()},toggleUpdate:function(){this.callBack?(this.callBack.cancel(),this.callBack="",this.pauseButton.setContent(M.util.get_string("resume","report_loglive"))):(this.callBack=l.later(1e3*this.get("interval"),this,this.fetchRecentLogs,null,!0),this.pauseButton.setContent(M.util.get_string("pause","report_loglive")))}},{NAME:"fetchLogs",ATTRS:{since:null,courseid:0,page:0,perpage:100,interval:60,logreader:"logstore_standard"}}),l.namespace("M.report_loglive.FetchLogs").init=function(e){return new t(e)}},"@VERSION@",{requires:["base","event","node","io","node-event-delegate"]});